<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../tangere/tangere.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../paper-behaviors/paper-button-behavior.html">
<link rel="import" href="../paper-styles/paper-styles.html" />
<link rel="import" href="../at-carbon-icon/at-carbon-icon.html" />

<!--
Material design: [Buttons](https://www.google.com/design/spec/components/buttons.html)

`at-carbon-button` is a button. When the user touches the button, a ripple effect emanates
from the point of contact. It may be flat or raised. A raised button is styled with a
shadow.

Example:

    <at-carbon-button>Flat button</at-carbon-button>
    <at-carbon-button raised>Raised button</at-carbon-button>
    <at-carbon-button noink>No ripple effect</at-carbon-button>
    <at-carbon-button toggles>Toggle-able button</at-carbon-button>

A button that has `toggles` true will remain `active` after being clicked (and
will have an `active` attribute set). For more information, see the `Polymer.IronButtonState`
behavior.

You may use custom DOM in the button body to create a variety of buttons. For example, to
create a button with an icon and some text:

    <at-carbon-button>
      <iron-icon icon="favorite"></iron-icon>
      custom button content
    </at-carbon-button>

To use `at-carbon-button` as a link, wrap it in an anchor tag. Since `at-carbon-button` will already
receive focus, you may want to prevent the anchor tag from receiving focus as well by setting
its tabindex to -1.

    <a href="https://www.polymer-project.org/" tabindex="-1">
      <at-carbon-button raised>Polymer Project</at-carbon-button>
    </a>

### Styling

Style the button with CSS as you would a normal DOM element.

    at-carbon-button.fancy {
      background: green;
      color: yellow;
    }

    at-carbon-button.fancy:hover {
      background: lime;
    }

    at-carbon-button[disabled],
    at-carbon-button[toggles][active] {
      background: red;
    }

By default, the ripple is the same color as the foreground at 25% opacity. You may
customize the color using the `--at-carbon-button-ink-color` custom property.

The following custom properties and mixins are also available for styling:

Custom property | Description | Default
----------------|-------------|----------
`--at-carbon-button-ink-color` | Background color of the ripple | `Based on the button's color`
`--at-carbon-button` | Mixin applied to the button | `{}`
`--at-carbon-button-disabled` | Mixin applied to the disabled button. Note that you can also use the `at-carbon-button[disabled]` selector | `{}`
`--at-carbon-button-flat-keyboard-focus` | Mixin applied to a flat button after it's been focused using the keyboard | `{}`
`--at-carbon-button-raised-keyboard-focus` | Mixin applied to a raised button after it's been focused using the keyboard | `{}`

@demo demo/index.html
-->

<dom-module id="at-carbon-button">
  <template strip-whitespace>
    <style>
      :host {
        display: inline-block;
        position: relative;
        box-sizing: border-box;
        min-width: 5.14em;
        margin: 0 0.29em;
        background: transparent;
        text-align: center;
        font: inherit;
        text-transform: uppercase;
        outline-width: 0;
        border-radius: 3px;
        -moz-user-select: none;
        -ms-user-select: none;
        -webkit-user-select: none;
        user-select: none;
        cursor: pointer;
        z-index: 0;
        padding: 0.7em 0.57em;

        @apply(--paper-font-common-base);
        @apply(--at-carbon-button);
      }

      :host([raised]) {
        box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14),
                    0 1px 5px 0 rgba(0, 0, 0, 0.12),
                    0 3px 1px -2px rgba(0, 0, 0, 0.2);
      }

      :host(:active),
      :host([active]) {
        box-shadow: 0 4px 5px 0 rgba(0, 0, 0, 0.14),
                    0 1px 10px 0 rgba(0, 0, 0, 0.12),
                    0 2px 4px -1px rgba(0, 0, 0, 0.4);
      }

      :host([raised].keyboard-focus) {
        font-weight: bold;
        @apply(--at-carbon-button-raised-keyboard-focus);
      }

      :host(:not([raised]).keyboard-focus) {
        font-weight: bold;
        @apply(--at-carbon-button-flat-keyboard-focus);
      }

      :host([disabled]) {
        background: #eaeaea;
        color: #a8a8a8;
        cursor: auto;
        pointer-events: none;
        box-shadow: none;

        @apply(--at-carbon-button-disabled);
      }

      .button-layout {
        display: flex;
        flex-direction: row;
      }

      .button-icon {

      }

      .button-label {
        flex: 1;
        @apply(--layout-self-center);
        @apply(--at-form-label-font);
        vertical-align: middle;
        
      }

      .button-label.with-icon {
        margin-left: 8px;
      }
    </style>

    <div hidden><content id="content"></content></div>
  </template>

  <script>
    Polymer({
      is: 'at-carbon-button',

      behaviors: [
        Polymer.IronButtonState,
        Polymer.IronControlState
        // Polymer.PaperButtonBehaviorImpl
      ],

      properties: {
        /**
         * If true, the button should be styled with a shadow.
         */
        raised: {
          type: Boolean,
          reflectToAttribute: true,
          value: false
        },

        /**
         * button label
         * 
         * @property label
         * @type String
         * @default ""
         */
        label: {
          type: String,
          value: ""          
        },

        /**
         * button icon
         * 
         * @property icon
         * @type String
         * @default ""
         */
        icon: {
          type: String,
          value: ""
        }
      },

      observers: [ '_renderContent(icon, label)'],

      _calculateElevation: function() {
        if (!this.raised) {
          this._setElevation(0);
        } else {
          Polymer.PaperButtonBehaviorImpl._calculateElevation.apply(this);
        }
      },

      _showInnerHtml: function(icon, label) {
        return !icon && !label;
      },

      _showIconAndLabel: function(icon, label) {
        return icon || label;
      },

      _computeClassList: function(icon) {
        var list = [ 'button-label' ];
        if (icon) {
          list.push('with-icon');
        }
        return list.join(" ");
      },

      attached: function() {
        var label = this.label;

        // text innerHTML or innerText for text content
        if (this.textContent !== "") {
          label = this.textContent;
        }

        this._renderContent(this.icon, label);
      },

      _renderContent: function(icon, label) {
        var buttonLayout = document.createElement('div');
        Polymer.dom(buttonLayout).classList.add('button-layout');

        if (icon) {
          var buttonIcon = document.createElement('at-carbon-icon');
          Polymer.dom(buttonIcon).classList.add('button-icon');
          buttonIcon.icon = icon;

          Polymer.dom(buttonLayout).appendChild(buttonIcon);
        }

        if (label) {
          var buttonLabel = document.createElement('span');
          Polymer.dom(buttonLabel).classList.add('button-label');
          if (icon) {
            Polymer.dom(buttonLabel).classList.add('with-icon');
          }
          buttonLabel.textContent = label;

          Polymer.dom(buttonLayout).appendChild(buttonLabel);
        }

        Polymer.dom(this.root).innerHTML = '';
        Polymer.dom(this.root).appendChild(buttonLayout);
      }


      /**
      Fired when the animation finishes.
      This is useful if you want to wait until
      the ripple animation finishes to perform some action.

      @event transitionend
      Event param: {{node: Object}} detail Contains the animated node.
      */
      
    });
  </script>
</dom-module>
